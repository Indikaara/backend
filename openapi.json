{
  "openapi": "3.0.0",
  "info": {
    "title": "Indikara Backend API",
    "version": "1.0.0",
    "description": "API for authentication, products, and health checks"
  },
  "servers": [
    {
      "url": "https://backend-wei5.onrender.com",
      "description": "Deployment server"
    },
    {
      "url": "http://localhost:5000",
      "description": "Development server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "isAdmin": {
            "type": "boolean"
          },
          "isDemo": {
            "type": "boolean"
          }
        }
      },
      "ProductPriceEntry": {
        "type": "object",
        "properties": {
          "size": {
            "type": "string"
          },
          "amount": {
            "type": "number"
          }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "id": {
            "type": "number"
          },
          "name": {
            "type": "string"
          },
          "price": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductPriceEntry"
            }
          },
          "image": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "story": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "details": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "color": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "weavingTechnique": {
            "type": "string"
          },
          "material": {
            "type": "string"
          },
          "manufacturer": {
            "type": "string"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "SKU": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "categoryId": {
            "type": "number"
          }
        }
      },
      "OrderProductItem": {
        "type": "object",
        "properties": {
          "product": {
            "type": "string",
            "description": "Product ObjectId or SKU"
          },
          "quantity": {
            "type": "number"
          },
          "price": {
            "type": "number"
          }
        }
      },
      "CreateOrderProductItem": {
        "type": "object",
        "properties": {
          "product": { "type": "string", "description": "Product ObjectId or SKU" },
          "quantity": { "type": "number" }
        }
      },
      "Order": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "txnid": {
            "type": "string"
          },
          "user": {
            "$ref": "#/components/schemas/User"
          },
          "products": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OrderProductItem"
            }
          },
          "shippingAddress": {
            "type": "object"
          },
          "totalPrice": {
            "type": "number"
          },
          "paymentMethod": {
            "type": "string"
          },
          "paymentResult": {
            "type": "object",
            "description": "Payment gateway response / reference"
          },
          "isPaid": {
            "type": "boolean"
          },
          "paidAt": {
            "type": "string",
            "format": "date-time"
          },
          "status": {
            "type": "string"
          }
        }
      },
      "WebhookEvent": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "provider": {
            "type": "string"
          },
          "payload": {
            "type": "object"
          },
          "headers": {
            "type": "object"
          },
          "ip": {
            "type": "string"
          },
          "hashValid": {
            "type": "boolean"
          },
          "status": {
            "type": "string"
          },
          "receivedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CreatePendingRequest": {
        "type": "object",
        "properties": {
          "products": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CreateOrderProductItem"
            }
          },
          "shippingAddress": {
            "type": "object"
          }
        },
        "required": ["products"]
      },
      "CreatePendingResponse": {
        "type": "object",
        "properties": {
          "order": {
            "$ref": "#/components/schemas/Order"
          },
          "txnid": {
            "type": "string"
          }
        }
      },
      "ComputeHashRequest": {
        "type": "object",
        "properties": {
          "txnid": {
            "type": "string"
          },
          "amount": {
            "type": "number"
          },
          "productinfo": {
            "type": "string"
          },
          "firstname": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          }
        },
        "required": [
          "txnid",
          "amount",
          "productinfo"
        ]
      },
      "ComputeHashResponse": {
        "type": "object",
        "properties": {
          "hash": {
            "type": "string"
          },
          "key": {
            "type": "string"
          }
        }
      },
      "AuthResponse": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "token": {
            "type": "string"
          }
        }
      }
    }
  },
  "paths": {
    "/api/admin/webhooks": {
      "get": {
        "summary": "List webhook events (admin only)",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "provider",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "hashValid",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated webhook events",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "page": {
                      "type": "integer"
                    },
                    "limit": {
                      "type": "integer"
                    },
                    "total": {
                      "type": "integer"
                    },
                    "events": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/WebhookEvent"
                      }
                    }
                  }
                },
                "examples": {
                  "sample": {
                    "value": {
                      "page": 1,
                      "limit": 20,
                      "total": 1,
                      "events": [
                        {
                          "_id": "evt_123",
                          "provider": "payu",
                          "status": "success",
                          "hashValid": true
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/register": {
      "post": {
        "summary": "Register a new user",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "email",
                  "password"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                }
              },
              "examples": {
                "demo": {
                  "value": {
                    "name": "Alice",
                    "email": "alice@example.com",
                    "password": "password123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "token": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "User already exists or invalid data"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "summary": "Login user",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "token": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid email or password"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/api/auth/demo-login": {
      "post": {
        "summary": "Create or fetch a demo user and return a JWT (dev only)",
        "tags": [
          "Auth"
        ],
        "responses": {
          "200": {
            "description": "Demo user created/fetched",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "demo": {
                    "value": {
                      "_id": "user_123",
                      "name": "Demo User",
                      "email": "demo@example.com",
                      "token": "jwt_token_here"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/seed-admin": {
      "post": {
        "summary": "Seed an admin user (dev only) and return JWT",
        "tags": [
          "Auth"
        ],
        "responses": {
          "200": {
            "description": "Admin user created/ensured",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                },
                "examples": {
                  "admin": {
                    "value": {
                      "_id": "admin_123",
                      "name": "Admin User",
                      "email": "admin@example.com",
                      "token": "jwt_admin_token_here"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/health": {
      "get": {
        "summary": "Health check",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "Health status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string"
                    },
                    "timestamp": {
                      "type": "string"
                    },
                    "uptime": {
                      "type": "number"
                    },
                    "services": {
                      "type": "object",
                      "properties": {
                        "app": {
                          "type": "string"
                        },
                        "database": {
                          "type": "string"
                        },
                        "oauth": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Health check failed"
          }
        }
      }
    },
    "/api/orders": {
      "post": {
        "summary": "Create a new order",
        "tags": [
          "Orders"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Order"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Order"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          }
        }
      }
    },
    "/api/orders/create-pending": {
      "post": {
        "summary": "Create a pending order and get a txnid (used for PayU)",
        "tags": [
          "Orders"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreatePendingRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Pending order created with txnid",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreatePendingResponse"
                },
                "examples": {
                  "demo": {
                    "value": {
                      "order": {
                        "txnid": "tx_12345",
                        "totalPrice": 100
                      },
                      "txnid": "tx_12345"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/orders/payu-success": {
      "post": {
        "summary": "Create an order after PayU redirects/callbacks (post-payment)",
        "tags": [
          "Orders"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Order"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Order created"
          }
        }
      }
    },
    "/api/orders/{id}": {
      "get": {
        "summary": "Get order by ID",
        "tags": [
          "Orders"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Order"
                }
              }
            }
          }
        }
      }
    },
    "/api/orders/my": {
      "get": {
        "summary": "Get orders for the logged-in user",
        "tags": [
          "Orders"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of orders",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Order"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/payu/hash": {
      "post": {
        "summary": "Compute PayU hash for a transaction (server-side)",
        "tags": [
          "PayU"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ComputeHashRequest"
              },
              "examples": {
                "demo": {
                  "value": {
                    "txnid": "tx_12345",
                    "amount": 100,
                    "productinfo": "Demo",
                    "firstname": "Demo",
                    "email": "demo@example.com"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Returns computed hash and merchant key",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ComputeHashResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/payu/initiate": {
      "post": {
        "summary": "Initiate PayU Hosted Checkout for an order",
        "tags": [
          "PayU"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "orderId": { "type": "string" }
                },
                "required": ["orderId"]
              },
              "examples": {
                "sample": { "value": { "orderId": "650f2a3b4c5d6e7f8a9b0c11" } }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Returns PayU hosted checkout form data and payment URL",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "formData": { "type": "object" },
                    "paymentUrl": { "type": "string" }
                  }
                },
                "examples": {
                  "sample": {
                    "value": {
                      "formData": {
                        "key": "your_merchant_key",
                        "txnid": "tx_1700000000000_1234",
                        "amount": "1999.00",
                        "productinfo": "Order #650f2a3b...",
                        "firstname": "Demo",
                        "email": "demo@example.com",
                        "surl": "https://yourdomain.com/pay-success",
                        "furl": "https://yourdomain.com/pay-fail",
                        "service_provider": "payu_paisa",
                        "hash": "<sha512-hash-goes-here>"
                      },
                      "paymentUrl": "https://test.payu.in/_payment"
                    }
                  }
                }
              }
            }
          },
          "400": { "description": "Bad request (e.g. order not found or referenced product missing)" },
          "401": { "description": "Unauthorized" },
          "500": { "description": "Server error" }
        }
      }
    },
    "/api/payu/webhook": {
      "post": {
        "summary": "PayU webhook endpoint (receives payment notifications)",
        "tags": [
          "PayU"
        ],
        "requestBody": {
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "key": {
                    "type": "string"
                  },
                  "txnid": {
                    "type": "string"
                  },
                  "amount": {
                    "type": "string"
                  },
                  "productinfo": {
                    "type": "string"
                  },
                  "firstname": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string"
                  },
                  "hash": {
                    "type": "string"
                  }
                }
              },
              "examples": {
                "success-demo": {
                  "value": {
                    "key": "your_key",
                    "txnid": "tx_12345",
                    "amount": "100",
                    "productinfo": "Demo",
                    "firstname": "Demo",
                    "email": "demo@example.com",
                    "status": "success",
                    "hash": "...",
                    "products": "[{\"product\":\"650f2a3b4c5d6e7f8a9b0c11\",\"quantity\":1}]",
                    "totalPrice": "100"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Invalid hash or payment"
          },
          "403": {
            "description": "Forbidden (IP not allowed)"
          }
        }
      }
    },
    "/api/products": {
      "get": {
        "summary": "Get all products",
        "tags": [
          "Products"
        ],
        "responses": {
          "200": {
            "description": "List of products",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "_id": {
                        "type": "string"
                      },
                      "id": {
                        "type": "number"
                      },
                      "name": {
                        "type": "string"
                      },
                      "price": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "size": {
                              "type": "string"
                            },
                            "amount": {
                              "type": "number"
                            }
                          }
                        }
                      },
                      "image": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "story": {
                        "type": "string"
                      },
                      "description": {
                        "type": "string"
                      },
                      "details": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "color": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "weavingTechnique": {
                        "type": "string"
                      },
                      "material": {
                        "type": "string"
                      },
                      "manufacturer": {
                        "type": "string"
                      },
                      "tags": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "SKU": {
                        "type": "string"
                      },
                      "category": {
                        "type": "string"
                      },
                      "categoryId": {
                        "type": "number"
                      },
                      "createdAt": {
                        "type": "string"
                      },
                      "updatedAt": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      },
      "post": {
        "summary": "Create a new product",
        "tags": [
          "Products"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "id",
                  "name",
                  "price",
                  "image",
                  "description",
                  "manufacturer",
                  "SKU",
                  "category",
                  "categoryId"
                ],
                "properties": {
                  "id": {
                    "type": "number"
                  },
                  "name": {
                    "type": "string"
                  },
                  "price": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "size": {
                          "type": "string"
                        },
                        "amount": {
                          "type": "number"
                        }
                      }
                    }
                  },
                  "image": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "story": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "details": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "color": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "weavingTechnique": {
                    "type": "string"
                  },
                  "material": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "manufacturer": {
                    "type": "string"
                  },
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "SKU": {
                    "type": "string"
                  },
                  "category": {
                    "type": "string"
                  },
                  "categoryId": {
                    "type": "number"
                  }
                }
              },
              "examples": {
                "demo": {
                  "value": {
                    "id": 1,
                    "name": "Demo Product",
                    "price": [
                      {
                        "size": "M",
                        "amount": 100
                      }
                    ],
                    "image": [
                      "https://example.com/image.jpg"
                    ],
                    "description": "A demo product",
                    "manufacturer": "Demo Maker",
                    "SKU": "DEMO-001",
                    "category": "textiles"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Product created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    },
                    "id": {
                      "type": "number"
                    },
                    "name": {
                      "type": "string"
                    },
                    "price": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "size": {
                            "type": "string"
                          },
                          "amount": {
                            "type": "number"
                          }
                        }
                      }
                    },
                    "image": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "story": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "color": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "weavingTechnique": {
                      "type": "string"
                    },
                    "material": {
                      "type": "string"
                    },
                    "manufacturer": {
                      "type": "string"
                    },
                    "tags": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "SKU": {
                      "type": "string"
                    },
                    "category": {
                      "type": "string"
                    },
                    "categoryId": {
                      "type": "number"
                    },
                    "createdAt": {
                      "type": "string"
                    },
                    "updatedAt": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid product data"
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/api/products/{id}": {
      "get": {
        "summary": "Get product by ID",
        "tags": [
          "Products"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Product ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Product details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    },
                    "id": {
                      "type": "number"
                    },
                    "name": {
                      "type": "string"
                    },
                    "price": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "size": {
                            "type": "string"
                          },
                          "amount": {
                            "type": "number"
                          }
                        }
                      }
                    },
                    "image": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "story": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "details": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "color": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "weavingTechnique": {
                      "type": "string"
                    },
                    "material": {
                      "type": "string"
                    },
                    "manufacturer": {
                      "type": "string"
                    },
                    "tags": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "SKU": {
                      "type": "string"
                    },
                    "category": {
                      "type": "string"
                    },
                    "categoryId": {
                      "type": "number"
                    },
                    "createdAt": {
                      "type": "string"
                    },
                    "updatedAt": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Product not found"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    }
  },
  "tags": []
}